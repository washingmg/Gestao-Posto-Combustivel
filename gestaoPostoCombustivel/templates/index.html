{% load static %}

<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Sistema de Combustível</title>
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>
  <div class="container">

    <aside class="sidebar">

      <h2 class="logo">Gestão</h2>

      <nav class="menu">

        <a href="{% url 'venda' %}">
          <button>Vender</button>
        </a>

        <a href="{% url 'reabastecer' %}">
          <button>Reabastecer</button>
        </a>

        <a href="{% url 'relatorio' %}">
          <button>Relatório</button>
        </a>

      </nav>

    </aside>

    <main class="main-content">

      <h1 class="title" style="text-align: center;">Gerenciamento de Combustível</h1>

      <div class="grid">

        {% for bomba in bombas %}

        <div class="pump-card">

          <h3>{{ bomba.nome }}</h3>

          <div class="levels">

            {% for combustivel_item in bomba.combustiveis %}

            <div class="fuel" data-quantidade-disponivel="{{ combustivel_item.quantidade_disponivel }}"
              data-capacidade-maxima="{{ combustivel_item.capacidade_maxima }}">

              <span>{{ combustivel_item.tipo }}</span>

              <div class="bar-container">

                <div class="bar"></div>
              </div>

              <span class="percentage"></span> {# O JS vai preencher isso #}

            </div>

            {% endfor %}

          </div>

        </div>
        
        {% endfor %}
        
      </div>

    </main>

  </div>
  <script>

    // Script para calcular e exibir a porcentagem de combustível
    document.addEventListener('DOMContentLoaded', function () {
      const fuelElements = document.querySelectorAll('.fuel');

      fuelElements.forEach(fuelElement => {
        const quantidadeDisponivel = parseFloat(fuelElement.dataset.quantidadeDisponivel);
        const capacidadeMaxima = parseFloat(fuelElement.dataset.capacidadeMaxima);

        let porcentagem = 0;
        if (capacidadeMaxima > 0) {
          porcentagem = (quantidadeDisponivel / capacidadeMaxima) * 100;
          porcentagem = Math.min(porcentagem, 100); // Garante que não passe de 100%
          porcentagem = Math.round(porcentagem); // Arredonda para o inteiro mais próximo
        }

        const barElement = fuelElement.querySelector('.bar');
        const percentageElement = fuelElement.querySelector('.percentage');

        // Atualiza a largura da barra
        barElement.style.width = porcentagem + '%';

       if (porcentagem <= 25) {
        barElement.classList.add('critical');    // Vermelho (crítico)
      } else if (porcentagem <= 49) {
        barElement.classList.add('orange');      // Laranja (atenção)
      } else if (porcentagem <= 75) {
        barElement.classList.add('yellow');      // Amarelo (alerta)
      } else {
        barElement.classList.add('normal');      // Verde (normal)
      }
      
        // Atualiza o texto da porcentagem
        percentageElement.textContent = porcentagem + '%';
      });
    });

  </script>
</body>

</html>